var y=Object.defineProperty;var c=(i,t)=>y(i,"name",{value:t,configurable:!0});var A=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var u=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};var m=(i,t,e)=>(A(i,t,"access private method"),e);var d=(i,t,e)=>new Promise((s,n)=>{var r=h=>{try{a(e.next(h))}catch(P){n(P)}},o=h=>{try{a(e.throw(h))}catch(P){n(P)}},a=h=>h.done?s(h.value):Promise.resolve(h.value).then(r,o);a((e=e.apply(i,t)).next())});var F=typeof window!="undefined"&&!!window.__loki_idb_debug;F&&console.log("DEBUG: Running opfs-adapter in DEBUG mode");var f,g,p=class{constructor(t){u(this,f);this.loadDatabase=c((t,e)=>{m(this,f,g).call(this).then(()=>{this.fs.getFileHandle(t,{create:!0}).then(s=>{s.getFile().then(n=>{n.text().then(r=>{this.options.beforeReadFromOPFS?this.options.beforeReadFromOPFS(r).then(o=>{o.length===0?e(null):e(o)}).catch(o=>e(o)):r.length===0?e(null):e(r)}).catch(r=>e(r))}).catch(n=>e(n))}).catch(s=>e(s))}).catch(s=>e(s))},"loadDatabase");this.saveDatabase=c((t,e,s)=>{m(this,f,g).call(this).then(()=>{this.fs.getFileHandle(t,{create:!0}).then(n=>{n.createWritable().then(r=>{this.options.beforeWriteToOPFS?this.options.beforeReadFromOPFS(e).then(o=>{r.write(o).then(()=>{r.close().then(()=>s({success:!0})).catch(a=>s(a))}).catch(a=>{r.close().then(()=>s(a)).catch(h=>s(h))})}):r.write(e).then(()=>{r.close().then(()=>s({success:!0})).catch(o=>s(o))}).catch(o=>{r.close().then(()=>s(o)).catch(a=>s(a))})}).catch(r=>s(r))}).catch(n=>s(n))}).catch(n=>s(n))},"saveDatabase");this.deleteDatabase=c((t,e)=>{m(this,f,g).call(this).then(()=>{this.fs.removeEntry(t).then(()=>e({success:!0})).catch(s=>e(s))}).catch(s=>e(s))},"deleteDatabase");this.options=t||{}}loadDatabaseAsync(t){return d(this,null,function*(){return new Promise((e,s)=>{this.loadDatabase(t,n=>{n instanceof Error?s(n):e(n)})})})}saveDatabaseAsync(t,e){return d(this,null,function*(){return new Promise((s,n)=>{this.saveDatabase(t,e,r=>{r instanceof Error?n(r):s()})})})}deleteDatabaseAsync(t){return d(this,null,function*(){return this.fs.removeEntry(t)})}};c(p,"OPFSAdapter"),f=new WeakSet,g=c(function(){return d(this,null,function*(){if(this.fs===null||this.fs===void 0)try{this.fs=yield navigator.storage.getDirectory()}catch(t){throw Error(`OPFSAdapter Error - unable to get OPFS: ${t}`)}})},"#initializeFS");typeof window!="undefined"&&Object.assign(window,{OPFSAdapter:p});export{p as OPFSAdapter};
//# sourceMappingURL=opfs-adapter.js.map
