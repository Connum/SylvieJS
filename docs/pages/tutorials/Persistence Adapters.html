<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Persistence Adapters.md | SylvieJS</title><meta name="description" content="Documentation for SylvieJS"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../../assets/style.css"/><link rel="stylesheet" href="../../assets/highlight.css"/><script async src="../../assets/search.js" id="search-script"></script><link rel="stylesheet" href="../../assets/pages.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base="../..">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="../../index.html" class="title">SylvieJS</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<ul class="tsd-breadcrumb">
<li><a href="../../modules.html">SylvieJS</a></li>
<li><span>Tutorials</span></li>
<li><a href="Persistence Adapters.html">Persistence Adapters.md</a></li></ul>
<h1> Persistence Adapters.md</h1></div>
<div class="tsd-panel tsd-typography">
<a href="#overview" id="overview" style="color: inherit; text-decoration: none;">
  <h1>Overview</h1>
</a>
<p>LokiJS persistence is implemented via an adapter interface.  We support autosave and autoload options, simple key/value adapters as well as &#39;reference mode&#39; adapters, and now internally support various methods of structured serialization which can ease creation of your own persistence adapters, as well as bulk or streamed data exchange.  </p>
<p>An important distinction between an in-memory database like lokijs and traditional database systems is that all documents/records are kept in memory and are not loaded as needed.  Persistence is therefore only for saving and restoring the state of this in-memory database.</p>
<blockquote>
<p>If your database is small enough and you wish to experiment, you can call db.serialize() to return a full serialization of your database and load it into another database instance such as dbcopy.loadJSON(str).</p>
</blockquote>

<a href="#nodejs-quickstart" id="nodejs-quickstart" style="color: inherit; text-decoration: none;">
  <h1>Node.js QuickStart</h1>
</a>
<p>If you are using lokijs in a node environment, we will automatically detect and use the built-in LokiFsAdapter without your needing to provide an adapter.</p>

<a href="#no-persistence-example-entirely-synchronous-and-in-memory-" id="no-persistence-example-entirely-synchronous-and-in-memory-" style="color: inherit; text-decoration: none;">
  <h3>No Persistence example (entirely synchronous and in memory) :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-8">loki</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;lokijs&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&quot;quickstart.db&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">users</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;users&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-2">users</span><span class="hl-1">.</span><span class="hl-3">insert</span><span class="hl-1">({</span><span class="hl-2">name:</span><span class="hl-4">&#39;odin&#39;</span><span class="hl-1">, </span><span class="hl-2">age:</span><span class="hl-1"> </span><span class="hl-5">50</span><span class="hl-1">});</span><br/><span class="hl-2">users</span><span class="hl-1">.</span><span class="hl-3">insert</span><span class="hl-1">({</span><span class="hl-2">name:</span><span class="hl-4">&#39;thor&#39;</span><span class="hl-1">, </span><span class="hl-2">age:</span><span class="hl-1"> </span><span class="hl-5">35</span><span class="hl-1">});</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-2">users</span><span class="hl-1">.</span><span class="hl-3">find</span><span class="hl-1">({ </span><span class="hl-2">age :</span><span class="hl-1"> { </span><span class="hl-2">$lte:</span><span class="hl-1"> </span><span class="hl-5">35</span><span class="hl-1"> } });</span><br/><br/><span class="hl-6">// dumps array with 1 doc (thor) to console</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">);</span>
</code></pre>

<a href="#autosaveautoload-quickstart-with-default-lokifsadapter-async-io-" id="autosaveautoload-quickstart-with-default-lokifsadapter-async-io-" style="color: inherit; text-decoration: none;">
  <h3>Autosave/autoload quickstart with default LokiFsAdapter (async i/o) :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;quickstart.db&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">// implement the autoloadback referenced in loki constructor</span><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">databaseInitialize</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">entries</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">getCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;entries&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">entries</span><span class="hl-1"> === </span><span class="hl-0">null</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">entries</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;entries&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// kick off any program logic or start listening to external events</span><br/><span class="hl-1">  </span><span class="hl-3">runProgramLogic</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">// example method with any bootstrap logic to run after database initialized</span><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">runProgramLogic</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">entryCount</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">getCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;entries&quot;</span><span class="hl-1">).</span><span class="hl-3">count</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;number of entries in database : &quot;</span><span class="hl-1"> + </span><span class="hl-2">entryCount</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/>
</code></pre>
<p>If you expect your database to grow over 100mb or you experience slow save speeds you might to use our more high-performance LokiFsStructuredAdapter. This adapter utilitizes es6 generator iterators and node streams to stream the database line by line.  It will also save each collection into its own file (partitioned) with a file name derived from the base name.  This database should scale to support databases just under 1 gb on the default node heap allocation of 1.4gb.  Increasing heap allocation, you can push this limit further. </p>

<a href="#an-example-using-fastest-and-most-scalable-lokifsstructuredadapter-for-nodejs-might-look-like-" id="an-example-using-fastest-and-most-scalable-lokifsstructuredadapter-for-nodejs-might-look-like-" style="color: inherit; text-decoration: none;">
  <h3>An example using fastest and most scalable LokiFsStructuredAdapter (for nodejs) might look like :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-8">loki</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&quot;lokijs&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-8">lfsa</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;../src/loki-fs-structured-adapter.js&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">adapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">lfsa</span><span class="hl-1">();</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;sandbox.db&#39;</span><span class="hl-1">, { </span><br/><span class="hl-1">  </span><span class="hl-2">adapter :</span><span class="hl-1"> </span><span class="hl-2">adapter</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">databaseInitialize</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">log</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">getCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;log&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">log</span><span class="hl-1"> === </span><span class="hl-0">null</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;log&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// log some random event data as part of our example</span><br/><span class="hl-1">  </span><span class="hl-2">log</span><span class="hl-1">.</span><span class="hl-3">insert</span><span class="hl-1">({ </span><span class="hl-2">event:</span><span class="hl-1"> </span><span class="hl-4">&#39;dbinit&#39;</span><span class="hl-1">, </span><span class="hl-2">dt:</span><span class="hl-1"> (</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Date</span><span class="hl-1">()).</span><span class="hl-3">getTime</span><span class="hl-1">() });</span><br/><span class="hl-1">}</span><br/>
</code></pre>

<a href="#web-quickstart" id="web-quickstart" style="color: inherit; text-decoration: none;">
  <h1>Web QuickStart</h1>
</a>
<p>If you are using lokijs in a web environment, we will automatically use the built-in LokiLocalStorageAdapter.  This adapter is limited to around 5mb so that won&#39;t last long but here is how to quickly get started experimenting with lokijs :</p>
<pre><code><span class="hl-1">&lt;</span><span class="hl-2">script</span><span class="hl-1"> </span><span class="hl-2">src</span><span class="hl-1">=</span><span class="hl-4">&quot;../../src/lokijs.js&quot;</span><span class="hl-1">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-1">&gt;</span>
</code></pre>

<a href="#example-constructing-loki-for-in-memory-only-or-manual-saveload-with-default-localstorage-adapter-" id="example-constructing-loki-for-in-memory-only-or-manual-saveload-with-default-localstorage-adapter-" style="color: inherit; text-decoration: none;">
  <h3>Example constructing loki for in-memory only or manual save/load (with default localStorage adapter) :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&quot;test.db&quot;</span><span class="hl-1">);</span>
</code></pre>

<a href="#example-constructing-loki-for-autoloadautosave-with-default-localstorage-adapter-" id="example-constructing-loki-for-autoloadautosave-with-default-localstorage-adapter-" style="color: inherit; text-decoration: none;">
  <h3>Example constructing loki for autoload/autosave (with default localStorage adapter) :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&quot;quickstart.db&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">databaseInitialize</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (!</span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">getCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;users&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&quot;users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/>
</code></pre>
<p>If you expect your database to grow up to 60megs you might want to use our LokiIndexedAdapter which can save to IndexedDb, if your browser supports it.  </p>

<a href="#example-using-more-scalable-lokiindexedadapter-" id="example-using-more-scalable-lokiindexedadapter-" style="color: inherit; text-decoration: none;">
  <h3>Example using more scalable LokiIndexedAdapter :</h3>
</a>
<pre><code><span class="hl-1">&lt;</span><span class="hl-2">script</span><span class="hl-1"> </span><span class="hl-2">src</span><span class="hl-1">=</span><span class="hl-4">&quot;../../src/lokijs.js&quot;</span><span class="hl-1">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-1">&gt;</span><br/><span class="hl-1">&lt;</span><span class="hl-2">script</span><span class="hl-1"> </span><span class="hl-2">src</span><span class="hl-1">=</span><span class="hl-4">&quot;../../src/loki-indexed-adapter.js&quot;</span><span class="hl-1">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-1">&gt;</span>
</code></pre>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">();</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&quot;test.db&quot;</span><span class="hl-1">, { </span><br/><span class="hl-1">  </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span>
</code></pre>
<p>If you expect your database to grow over 60megs things start to get browser dependent.  To provide singular guidance and since Chrome is the most popular web browser you will want to employ our LokiPartitioningAdapter in addition to our LokiIndexedAdapter.  To sum up as briefly as possible, this will divide collections into their own files and if a collection exceeds 25megs (customizable) it will subdivide into separate pages(files).  This allows our indexed db adapter to accomplish a single database save/load using many key/value pairs.  This adapter will allow scaling up to around 300mb or so in current testing.  </p>

<a href="#an-example-using-the-lokipartitioningadapter-along-with-lokiindexedadapter-might-appear-as-" id="an-example-using-the-lokipartitioningadapter-along-with-lokiindexedadapter-might-appear-as-" style="color: inherit; text-decoration: none;">
  <h3>An example using the LokiPartitioningAdapter along with LokiIndexedAdapter might appear as :</h3>
</a>
<pre><code><span class="hl-1">&lt;</span><span class="hl-2">script</span><span class="hl-1"> </span><span class="hl-2">src</span><span class="hl-1">=</span><span class="hl-4">&quot;../../src/lokijs.js&quot;</span><span class="hl-1">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-1">&gt;</span><br/><span class="hl-1">&lt;</span><span class="hl-2">script</span><span class="hl-1"> </span><span class="hl-2">src</span><span class="hl-1">=</span><span class="hl-4">&quot;../../src/loki-indexed-adapter.js&quot;</span><span class="hl-1">&gt;&lt;/</span><span class="hl-9">script</span><span class="hl-1">&gt;</span>
</code></pre>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">();</span><br/><br/><span class="hl-6">// use paging only if you expect a single collection to be over 50 megs or so</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiPartitioningAdapter</span><span class="hl-1">(</span><span class="hl-2">idbAdapter</span><span class="hl-1">, { </span><span class="hl-2">paging:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test.db&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#example-using-incrementalindexeddbadapter" id="example-using-incrementalindexeddbadapter" style="color: inherit; text-decoration: none;">
  <h3>Example using IncrementalIndexedDBAdapter</h3>
</a>
<p>A newer, more advanced alternative to <code>LokiIndexedAdapter</code> with <code>LokiPartitioningAdapter</code> is to use <code>IncrementalIndexedDBAdapter</code>.
Unlike <code>LokiIndexedAdapter</code>, the database is saved not as one big JSON blob (or even pages of individual collections), but split into
small chunks with individual collection documents. When saving, only the chunks with changed
documents (and database metadata) is saved to IndexedDB. This speeds up small incremental
saves by an order of magnitude on large (tens of thousands of records) databases. It also
avoids Safari 13 bug that would cause the database to balloon in size to gigabytes.</p>
<p><code>IncrementalIndexedDBAdapter</code> is not backwards compatible with <code>LokiIndexedAdapter</code>.</p>
<pre><code class="language-html"><span class="hl-11">&lt;</span><span class="hl-12">script</span><span class="hl-13"> </span><span class="hl-14">src</span><span class="hl-13">=</span><span class="hl-15">&quot;../../src/lokijs.js&quot;</span><span class="hl-11">&gt;&lt;/</span><span class="hl-12">script</span><span class="hl-11">&gt;</span><br/><span class="hl-11">&lt;</span><span class="hl-12">script</span><span class="hl-13"> </span><span class="hl-14">src</span><span class="hl-13">=</span><span class="hl-15">&quot;../../src/incremental-indexeddb-adapter.js&quot;</span><span class="hl-11">&gt;&lt;/</span><span class="hl-12">script</span><span class="hl-11">&gt;</span>
</code></pre>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;TestDatabase&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">IncrementalIndexedDBAdapter</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">databaseInitialize</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">4000</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#description-of-lokinativescriptadapter" id="description-of-lokinativescriptadapter" style="color: inherit; text-decoration: none;">
  <h1>Description of LokiNativescriptAdapter</h1>
</a>
<p>This adapter can be used when developing a nativescript application for iOS or Android, it persists the loki db to the filesystem using the native platform api.</p>

<a href="#simple-example-of-using-lokinativescriptadapter-" id="simple-example-of-using-lokinativescriptadapter-" style="color: inherit; text-decoration: none;">
  <h3>Simple Example of using LokiNativescriptAdapter :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-8">loki</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1"> (</span><span class="hl-4">&#39;lokijs&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-8">LokiNativescriptAdapter</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;lokijs/src/loki-nativescript-adapter&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;loki.json&#39;</span><span class="hl-1">,{</span><br/><span class="hl-1">            </span><span class="hl-2">adapter:</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiNativescriptAdapter</span><span class="hl-1">()</span><br/><span class="hl-1">});</span>
</code></pre>
<blockquote>
<p>In addition to the above adapters which are included in the lokijs distro, several community members have also created their own adapters using this adapter interface.  Some of these include : </p>
</blockquote>
<ul>
<li>Cordova adapter : <a href="https://github.com/cosmith/loki-cordova-fs-adapter">https://github.com/cosmith/loki-cordova-fs-adapter</a></li>
<li>localForage adapter : <a href="https://github.com/paulhovey/loki-localforage-adapter">https://github.com/paulhovey/loki-localforage-adapter</a></li>
</ul>

<a href="#configuring-persistence-adapters" id="configuring-persistence-adapters" style="color: inherit; text-decoration: none;">
  <h1>Configuring persistence adapters</h1>
</a>

<a href="#autosave-autoload-and-close" id="autosave-autoload-and-close" style="color: inherit; text-decoration: none;">
  <h2>Autosave, Autoload and close()</h2>
</a>
<p>LokiJS now supports automatic saving at user defined intervals, configured via loki constructor options.  This is supported for all persistenceMethods.  Data is only saved if changes have occurred since the last save.  You can also specify an autoload to immediately load a saved database during new loki construction.  If you need to process anything on load completion you can also specify your own autoloadCallback.  Finally, in an autosave scenario, if the user wants to exit or is notified of leaving the webpage (window.onbeforeunload) you can call close() on the database which will perform a final save (if needed).</p>
<blockquote>
<p><em><strong>Note : the ability of loki to &#39;flush&#39; data on events such as a browsers onbeforeunload event, depends on the storage adapter being synchronous.  Local storage and file system adapters are synchronous but indexeddb is asynchronous and cannot save when triggered from db.close() in an onbeforeunload event.  The mouseleave event may allow enough time to perform a preemptive save.</strong></em></p>
</blockquote>

<a href="#autosave-example" id="autosave-example" style="color: inherit; text-decoration: none;">
  <h3>Autosave example</h3>
</a>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;loki&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">        </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">10000</span><span class="hl-1">, </span><span class="hl-6">// 10 seconds</span><br/><span class="hl-1">        </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><br/><span class="hl-1">      });</span>
</code></pre>

<a href="#autosave-with-autoload-example" id="autosave-with-autoload-example" style="color: inherit; text-decoration: none;">
  <h3>Autosave with autoload example</h3>
</a>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">lokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;loki&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test.db&#39;</span><span class="hl-1">, </span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-2">autoload:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">autoloadCallback :</span><span class="hl-1"> </span><span class="hl-2">loadHandler</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">autosave:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">        </span><span class="hl-2">autosaveInterval:</span><span class="hl-1"> </span><span class="hl-5">10000</span><span class="hl-1">, </span><span class="hl-6">// 10 seconds</span><br/><span class="hl-1">        </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><br/><span class="hl-1">      }); </span><br/><br/><span class="hl-1">    </span><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">loadHandler</span><span class="hl-1">() {</span><br/><span class="hl-1">      </span><span class="hl-6">// if database did not exist it will be empty so I will intitialize here</span><br/><span class="hl-1">      </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">coll</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">getCollection</span><span class="hl-1">(</span><span class="hl-4">&#39;entries&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">coll</span><span class="hl-1"> === </span><span class="hl-0">null</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">coll</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&#39;entries&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span>
</code></pre>
<p><a href="https://rawgit.com/techfort/LokiJS/master/examples/sandbox/LokiSandbox.htm#rawgist=https://gist.githubusercontent.com/obeliskos/447edca33d1274dd9a64767d23df56e9/raw/740d3bedc1ed76d3718acd207b6913281a11ed78/autoloadCallback">Try in Loki Sandbox</a>.</p>

<a href="#save-throttling-and-persistence-contention-management" id="save-throttling-and-persistence-contention-management" style="color: inherit; text-decoration: none;">
  <h1>Save throttling and persistence contention management</h1>
</a>
<p>LokiJS now supports throttled saves and loads to avoid overlapping saveDatabase and loadDatabase calls from interfering with each other.  This is controlled by a loki constructor option called &#39;throttledSaves&#39; and the default for that option is &#39;true&#39;. </p>
<p>This means that within any single Loki database instance, multiple saves routed to the persistence adapter will be throttled and ensured to not conflict by overlap.  With save throttling, during the time between an adapter save and an adapter response to that save, if new save requests come in we will queue those requests (and their callbacks) for a save which we will initiate immediately after the current save is complete.  In that situation, if 10 requests to save had been made while a save is pending, the subsequent (single) save will callback all ten queued/tiered callbacks when -it- completes.  </p>
<p>If a loadDatabase call occurs while a save is pending, we will (by default) wait indefinitely for the queue to deplete without being replenished.  Once that occurs we will lock all saves during the load... any incoming save requests made while the database is being loaded will then be queued for saving once the load is completed.  Since loadDatabase now internally calls a new &#39;throttledSaveDrain&#39; we will pass through options to control that drain. (These options will be summarized below).</p>
<p>You may also directly call this &#39;throttledSaveDrain&#39; loki method which can wait for the queue to drain. You might do this using any of these variations/options : </p>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-6">// wait indefinitely (recursively)</span><br/><span class="hl-1">    </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">throttledSaveDrain</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;no saves in progress&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span>
</code></pre>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-6">// wait only for the -current- queue to deplete</span><br/><span class="hl-1">    </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">throttledSaveDrain</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;queue drained&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }, { </span><span class="hl-2">recursiveWait:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1"> } );</span>
</code></pre>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-6">// wait recursively but only for so long...</span><br/><span class="hl-1">    </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">throttledSaveDrain</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;no saves in progress&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;taking too long, try again later&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }, { </span><span class="hl-2">recursiveWaitLimit:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-2">recursiveWaitLimitDuration:</span><span class="hl-1"> </span><span class="hl-5">2000</span><span class="hl-1"> });</span>
</code></pre>
<p>If you do not wish loki to supervise these conflicts with its throttling contention management, you can disable this by constructing loki with the following option (in addition to any existing options you are passing) : </p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test.db&#39;</span><span class="hl-1">, { </span><span class="hl-2">throttledSaves:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1"> });</span>
</code></pre>

<a href="#creating-your-own-loki-persistence-adapters" id="creating-your-own-loki-persistence-adapters" style="color: inherit; text-decoration: none;">
  <h1>Creating your own Loki Persistence Adapters</h1>
</a>
<p>Lokijs currently supports two types of database adapters : &#39;basic&#39;, and &#39;reference&#39; mode adapters. Basic adapters are passed a string to save and return a string when loaded... this is well suited to key/value stores.  Reference mode adapters are passed a reference to the database itself where it can save however it wishes to.  When loading, reference mode adapters can return an object reference or serialized string.  Below we will describe the minimal functionality which lokijs requires, you may want to provide additional adapter functionality for deleting or inspecting its persistence store.</p>

<a href="#creating-your-own-39basic39-persistence-adapter" id="creating-your-own-39basic39-persistence-adapter" style="color: inherit; text-decoration: none;">
  <h1>Creating your own &#39;Basic&#39; persistence adapter</h1>
</a>
<pre><code class="language-javascript"><span class="hl-9">MyCustomAdapter</span><span class="hl-1">.</span><span class="hl-2">prototype</span><span class="hl-1">.</span><span class="hl-3">loadDatabase</span><span class="hl-1"> = </span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">dbname</span><span class="hl-1">, </span><span class="hl-2">callback</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">// using dbname, load the database from wherever your adapter expects it</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">serializedDb</span><span class="hl-1"> = </span><span class="hl-2">localStorage</span><span class="hl-1">[</span><span class="hl-2">dbname</span><span class="hl-1">];</span><br/><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1"> = </span><span class="hl-0">true</span><span class="hl-1">; </span><span class="hl-6">// make your own determinations</span><br/><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-2">serializedDb</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-4">&quot;There was a problem loading the database&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>and a saveDatabase example might look like : </p>
<pre><code class="language-javascript"><span class="hl-9">MyCustomAdapter</span><span class="hl-1">.</span><span class="hl-2">prototype</span><span class="hl-1">.</span><span class="hl-3">saveDatabase</span><span class="hl-1"> = </span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">dbname</span><span class="hl-1">, </span><span class="hl-2">dbstring</span><span class="hl-1">, </span><span class="hl-2">callback</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">// store the database, for this example to localstorage</span><br/><span class="hl-1">  </span><span class="hl-2">localStorage</span><span class="hl-1">[</span><span class="hl-2">dbname</span><span class="hl-1">] = </span><span class="hl-2">dbstring</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1"> = </span><span class="hl-0">true</span><span class="hl-1">;  </span><span class="hl-6">// make your own determinations</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">null</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-4">&quot;An error was encountered loading &quot;</span><span class="hl-1"> + </span><span class="hl-2">dbname</span><span class="hl-1"> + </span><span class="hl-4">&quot; database.&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#creating-your-own-39reference-mode39-persistence-adapter" id="creating-your-own-39reference-mode39-persistence-adapter" style="color: inherit; text-decoration: none;">
  <h1>Creating your own &#39;Reference Mode&#39; persistence adapter</h1>
</a>
<p>An additional &#39;level&#39; of adapter support would be for your adapter to support <strong>&#39;reference&#39;</strong> mode support.  This &#39;reference&#39; mode will allow lokijs to provide your adapter with a reference to a lightweight &#39;copy&#39; of the database sharing only the collection.data[] document object instances with the original database. You would use this reference to destructure or save however you want to.</p>
<p>To instruct loki that your adapter supports &#39;reference&#39; mode, you will need to implement a top level property called &#39;mode&#39; on your adapter and set it equal to &#39;reference&#39;.  Having done that and configured that adapter to be used, whenever loki wishes to save the database it will instead call out to an exportDatabase() method on your adapter.  </p>
<p>A simple example of an advanced &#39;reference&#39; mode adapter might look like : </p>
<pre><code class="language-javascript"><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">YourAdapter</span><span class="hl-1">() {</span><br/><span class="hl-1">   </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-2">mode</span><span class="hl-1"> = </span><span class="hl-4">&quot;reference&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">YourAdapter</span><span class="hl-1">.</span><span class="hl-2">prototype</span><span class="hl-1">.</span><span class="hl-3">exportDatabase</span><span class="hl-1"> = </span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">dbname</span><span class="hl-1">, </span><span class="hl-2">dbref</span><span class="hl-1">, </span><span class="hl-2">callback</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">customSaveLogic</span><span class="hl-1">(</span><span class="hl-2">dbref</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1"> = </span><span class="hl-0">true</span><span class="hl-1">; </span><span class="hl-6">// make your own determinations</span><br/><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">null</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-4">&quot;some error occurred.&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">// reference mode uses the same loadDatabase method signature</span><br/><span class="hl-9">YourAdapter</span><span class="hl-1">.</span><span class="hl-2">prototype</span><span class="hl-1">.</span><span class="hl-3">loadDatabase</span><span class="hl-1"> = </span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">dbname</span><span class="hl-1">, </span><span class="hl-2">callback</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">// do some magic to reconstruct a new loki database object instance from wherever</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">newDatabase</span><span class="hl-1"> = </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">customLoadLogic</span><span class="hl-1">();</span><br/><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1"> = </span><span class="hl-0">true</span><span class="hl-1">; </span><span class="hl-6">// make you own determinations</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// once reconstructed, loki will expect either a serialized response or a Loki object instance to reinflate from</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-2">success</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-2">newSerialized</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Error</span><span class="hl-1">(</span><span class="hl-4">&quot;some error&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#lokipartitioningadapter" id="lokipartitioningadapter" style="color: inherit; text-decoration: none;">
  <h1>LokiPartitioningAdapter</h1>
</a>
<p>This is an adapter for adapters.  It wraps around and converts any &#39;basic&#39; persistence adapter into one that scales nicely to your memory contraints.  It can split your database up, saving each collection independently and only if changes have occurred since the last save.  Since each collection is saved separately there is lower memory overhead and since only dirty collections are saved there is improved i/o save speeds. </p>
<blockquote>
<p>Chrome (using indexedDb) places a restriction on how large a single saved &#39;chunk&#39; can be, this Partitioning adapter with just partitioning raises that limit from being &#39;per db&#39; to &#39;per collection&#39;... when paging is enabled that limit is raised to being &#39;per document&#39;.  Chrome indexedDb limit is somewhere around 30-60megs sized chunks.  </p>
</blockquote>
<p>An example using partition adapter with our LokiIndexedAdapter might appear such as :</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;appAdapter&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiPartitioningAdapter</span><span class="hl-1">(</span><span class="hl-2">idbAdapter</span><span class="hl-1">);</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;sandbox.db&#39;</span><span class="hl-1">, { </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> });</span>
</code></pre>
<p>If you expect a single collection to grow rather large you may even want to utilize an additional &#39;paging&#39; mode that this adapter provides.  This is useful if you want to limit the size of data sent to the inner persistence adapter. This paging mode was added to accomodate a Chrome limitation on maximum record sizes.  An example using paging mode might appear as follows :</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;appAdapter&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiPartitioningAdapter</span><span class="hl-1">(</span><span class="hl-2">idbAdapter</span><span class="hl-1">, { </span><span class="hl-2">paging:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;sandbox.db&#39;</span><span class="hl-1">, { </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> });</span>
</code></pre>
<p>You can also pass in a pageSize option if you wish to use a page size other than the default 25meg page size.</p>
<pre><code class="language-javascript"><span class="hl-6">// set up adapter to page using 35 meg page size</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">pa</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiPartitioningAdapter</span><span class="hl-1">(</span><span class="hl-2">idbAdapter</span><span class="hl-1">, { </span><span class="hl-2">paging:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-2">pageSize:</span><span class="hl-5">35</span><span class="hl-1">*</span><span class="hl-5">1024</span><span class="hl-1">*</span><span class="hl-5">1024</span><span class="hl-1"> });</span>
</code></pre>

<a href="#lokimemoryadapter" id="lokimemoryadapter" style="color: inherit; text-decoration: none;">
  <h1>LokiMemoryAdapter</h1>
</a>
<p>This &#39;basic&#39; persistence adapter is only intended for experimenting and testing since it retains its key/value store in memory and will be lost when session is done.  This enables us to verify the partitioning adapter works and can be used to mock persistence for unit testing. </p>
<p>You might access this memory adapter (which is included in the main source file) similarly to the following :</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">mem</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiMemoryAdapter</span><span class="hl-1">();</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;sandbox.db&#39;</span><span class="hl-1">, {</span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">mem</span><span class="hl-1">});</span>
</code></pre>
<p>If you wish to simulate asynchronous &#39;basic&#39; adapter you can pass options to its constructor : </p>
<pre><code class="language-javascript"><span class="hl-6">// simulate 50ms async delay for loads and saves. this will yield thread until then</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">mem</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">loki</span><span class="hl-1">.</span><span class="hl-3">LokiMemoryAdapter</span><span class="hl-1">({ </span><span class="hl-2">asyncResponses:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-2">asyncTimeout:</span><span class="hl-1"> </span><span class="hl-5">50</span><span class="hl-1"> });</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;sandbox.db&#39;</span><span class="hl-1">, {</span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">mem</span><span class="hl-1">});</span>
</code></pre>
<blockquote>
<p>In order to see LokiPartitioningAdapter used in conjunction with LokiMemoryAdapter you can view this <a href="https://rawgit.com/techfort/LokiJS/master/examples/sandbox/LokiSandbox.htm#rawgist=https://gist.githubusercontent.com/obeliskos/15c1aa87da16cd89b328eb84bbcdf8fa/raw/d91ac3fee212dc5aa96cb05f479d825faa17c1c8/PartitionedMemoryAdapterTest">Loki Sandbox gist</a> in your browser.  </p>
</blockquote>
<p>What is happening in the gist linked above is that we create an instance of a LokiMemoryAdapter and pass that instance to the LokiPartitioningAdapter.  We utilimately pass in the created LokiPartitioningAdapter instance to the database constructor.  We then add multiple collections to our database, save it, update one of the collections (causing that collection&#39;s &#39;dirty&#39; flag to be set), and save again.  When we examine the output of the script we can view the contents of the memory adapter&#39;s internal hash store to see how there are multiple keys for a single database.  We can also see that our modified collection (along with the database container itself) was saved again.  The database container currently has no &#39;dirty&#39; flag set but since we remove all collection.data[] object instances from it, it is relatively lightweight.</p>

<a href="#39rolling-your-own39-structured-serialization-mechanism" id="39rolling-your-own39-structured-serialization-mechanism" style="color: inherit; text-decoration: none;">
  <h1>&#39;Rolling your own&#39; structured serialization mechanism</h1>
</a>
<p>In addition to the <a href="https://github.com/techfort/LokiJS/wiki/Changes-API">ChangesAPI</a> which can be utilized to isolate changesets, LokiJS has established several internal utility methods to assist users in developing optimal persistence or transmission of database contents. </p>
<p>Those mechanisms include the ability to decompose the database into &#39;partitions&#39; of structured serializations or assembled into a line oriented format (non-partitioned) and either delimited (single delimited string per collection) or non-delimited (array of strings, one per document).  These utility methods are located on the Loki object instance itself as the &#39;serializeDestructured&#39; and &#39;deserializeDestructured&#39; methods.  They can be invoked to create structured json serialization for the entire database, or (if you pass a partition option) it can provide a single partition at a time.  Internal loki structured serialization in its current form provides mild memory overhead reduction and decreases I/O time if only some collections need to be saved.  It may also be useful for other data exchange or synchronization mechanisms. </p>
<p>In lokijs terminology the partitions of a database include the database container (partition -1) along with each individual collection (partitions 0-n).</p>
<p>To destructure in various formats you can experiment with the following parameters :</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">serializeDestructured</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">partitioned:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">delimited:</span><span class="hl-1"> </span><span class="hl-0">false</span><br/><span class="hl-1">});</span>
</code></pre>
<p>To destructure a single partition you might use the following syntax and experiment with &#39;delimited&#39; and &#39;partition&#39; properties :</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">serializeDestructured</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">partitioned:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">partition:</span><span class="hl-1"> </span><span class="hl-5">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">delimited:</span><span class="hl-1"> </span><span class="hl-0">false</span><br/><span class="hl-1">});</span>
</code></pre>
<blockquote>
<p>To experiment with the various structured serialization formats you can view this <a href="https://rawgit.com/techfort/LokiJS/master/examples/sandbox/LokiSandbox.htm#rawgist=https://gist.githubusercontent.com/obeliskos/98a73205d7fe9746a687634e19a5eb89/raw/3821c9bbb6bae2689b00d16be9fae78dff430e28/destructuring%2520demo">Loki Sandbox gist</a> and try various combinations of &#39;partitioned&#39; and &#39;delimited&#39; options (making sure both the serializeDestructured and deserializeDestructured use the same values.</p>
</blockquote>
<p>Destructuring (making many smaller json serializations vs one large serialization) does not lower memory overhead but seems to be a little faster.  Partitioning can reduce memory overhead if you can dispose of those memory chunks before advancing to the next (which our adapter implementations do).  Our 2.0.0 branch which is able to use ES6 language constructs may gain an iterable interface in the future for data exchange or line-by-line streaming.</p>
<p>If your database is small enough you can use the LokiPartitioningAdapter (with or without paging) along with LokiMemoryAdapter to decompose database into appropriately sized &#39;chunks&#39; for transmission.</p>

<a href="#detailed-lokiindexedadapter-description" id="detailed-lokiindexedadapter-description" style="color: inherit; text-decoration: none;">
  <h1>Detailed LokiIndexedAdapter Description</h1>
</a>
<p>Our LokiIndexedAdapter is implemented as a &#39;basic&#39; mode loki persistence adapter.  Since this will probably be the default web persistence adapter, this section will overview some of its advanced features.  </p>
<p>It implements persistence by defining an app/key/value database in indexeddb for storing serialized databases (or partitions).  The &#39;app&#39; portion is designated when instantiating the adapter and loki only supplies it key/value pair for storage.</p>

<a href="#simple-example-of-using-lokiindexedadapter-for-browser-environments-" id="simple-example-of-using-lokiindexedadapter-for-browser-environments-" style="color: inherit; text-decoration: none;">
  <h3>Simple Example of using LokiIndexedAdapter (for browser environments) :</h3>
</a>
<pre><code class="language-javascript"><span class="hl-11">&lt;</span><span class="hl-12">script</span><span class="hl-1"> </span><span class="hl-14">src</span><span class="hl-1">=</span><span class="hl-4">&quot;scripts/lokijs/lokijs.js&quot;</span><span class="hl-11">&gt;&lt;/</span><span class="hl-12">script</span><span class="hl-11">&gt;</span><br/><span class="hl-11">&lt;</span><span class="hl-12">script</span><span class="hl-1"> </span><span class="hl-14">src</span><span class="hl-1">=</span><span class="hl-4">&quot;scripts/lokijs/loki-indexed-adapter.js&quot;</span><span class="hl-11">&gt;&lt;/</span><span class="hl-12">script</span><span class="hl-11">&gt;</span>
</code></pre>
<p>...</p>
<pre><code class="language-javascript"><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">, { </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> });</span>
</code></pre>
<p>Note the &#39;finance&#39; in this case represents an &#39;App&#39; context and the &#39;test&#39; designates the key (or database name)... the &#39;value&#39; is the serialized strings representing your database which loki will provide. Advantages include larger storage limits over localstorage, and a catalog based approach where you can store many databases, grouped by an &#39;App&#39; context.  Since indexedDB storage is provided &#39;per-domain&#39;, and on any given domain you might be running several web &#39;apps&#39; each with its own database(s), this structure allows for organization and expandibility.</p>
<blockquote>
<p><em><strong>Note : the &#39;App&#39; context is an conceptual separation, not a security partition. Security is provided by your web browser, partitioned per-domain within client storage in the browser/system.</strong></em></p>
</blockquote>

<a href="#loki-indexed-adapter-interface" id="loki-indexed-adapter-interface" style="color: inherit; text-decoration: none;">
  <h1>Loki Indexed adapter interface</h1>
</a>
<p>In addition to core loadDatabase and saveDatabase methods, the loki Indexed adapter provides the ability to getDatabaseList (for the current app context), deleteDatabase, and getCatalogSummary to retrieve unfiltered list of app/keys along with the size in database.  (Note sizes reported may not be Unicode sizes so effective &#39;size&#39; it may consume might be double that amount as indexeddb saves in Unicode).  The loki indexed adapter also is console-friendly... even though indexeddb is highly asynchronous, relying on callbacks, you can omit callbacks for many of its methods and will log results to console instead.  This makes experimenting, diagnosing, and maintenance of loki catalog easier to learn and inspect.</p>

<a href="#full-examples-of-using-loki-indexed-adapter" id="full-examples-of-using-loki-indexed-adapter" style="color: inherit; text-decoration: none;">
  <h3>Full Examples of using loki indexed adapter</h3>
</a>
<pre><code class="language-javascript"><span class="hl-1">  </span><span class="hl-6">// Save : will save App/Key/Val as &#39;finance&#39;/&#39;test&#39;/{serializedDb}</span><br/><span class="hl-1">  </span><span class="hl-6">// if appContect (&#39;finance&#39; in this example) is omitted, &#39;loki&#39; will be used</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">lokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">, { </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">coll</span><span class="hl-1"> = </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">addCollection</span><span class="hl-1">(</span><span class="hl-4">&#39;testColl&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">coll</span><span class="hl-1">.</span><span class="hl-3">insert</span><span class="hl-1">({</span><span class="hl-2">test:</span><span class="hl-1"> </span><span class="hl-4">&#39;val&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">  </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">saveDatabase</span><span class="hl-1">();  </span><span class="hl-6">// could pass callback if needed for async complete</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Load database</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">loki</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">, { </span><span class="hl-2">adapter:</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-3">loadDatabase</span><span class="hl-1">({}, </span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&#39;done&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Get database list</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">idbAdapter</span><span class="hl-1">.</span><span class="hl-3">getDatabaseList</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">// result is array of string names for that appcontext (&#39;finance&#39;)</span><br/><span class="hl-1">    </span><span class="hl-2">result</span><span class="hl-1">.</span><span class="hl-3">forEach</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">str</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-2">str</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-6">// Delete database</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">idbAdapter</span><span class="hl-1">.</span><span class="hl-3">deleteDatabase</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">); </span><span class="hl-6">// delete &#39;finance&#39;/&#39;test&#39; value from catalog</span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Delete database partitions and/or pages</span><br/><span class="hl-1">  </span><span class="hl-6">// This deletes all partitions or pages derived from this base filename</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">idbAdapter</span><span class="hl-1">.</span><span class="hl-3">deleteDatabasePartitions</span><span class="hl-1">(</span><span class="hl-4">&#39;test&#39;</span><span class="hl-1">); </span><br/><br/><span class="hl-1">  </span><span class="hl-6">// Summary</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">idbAdapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;finance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">idbAdapter</span><span class="hl-1">.</span><span class="hl-3">getCatalogSummary</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">entries</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">entries</span><span class="hl-1">.</span><span class="hl-3">forEach</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;app : &quot;</span><span class="hl-1"> + </span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">app</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;key : &quot;</span><span class="hl-1"> + </span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-4">&quot;size : &quot;</span><span class="hl-1"> + </span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">size</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  });</span><br/>
</code></pre>

<a href="#examples-of-using-loki-indexed-adapter-from-console" id="examples-of-using-loki-indexed-adapter-from-console" style="color: inherit; text-decoration: none;">
  <h3>Examples of using loki Indexed adapter from console</h3>
</a>
<pre><code class="language-javascript"><span class="hl-1">  </span><span class="hl-6">// CONSOLE USAGE : if using from console for management/diagnostic, here are a few examples :</span><br/><span class="hl-1">  </span><span class="hl-0">var</span><span class="hl-1"> </span><span class="hl-2">adapter</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">LokiIndexedAdapter</span><span class="hl-1">(</span><span class="hl-4">&#39;loki&#39;</span><span class="hl-1">);  </span><span class="hl-6">// or whatever appContext you want to use</span><br/><span class="hl-1">  </span><span class="hl-2">adapter</span><span class="hl-1">.</span><span class="hl-3">getDatabaseList</span><span class="hl-1">(); </span><span class="hl-6">// with no callback passed, this method will log results to console</span><br/><span class="hl-1">  </span><span class="hl-2">adapter</span><span class="hl-1">.</span><span class="hl-3">saveDatabase</span><span class="hl-1">(</span><span class="hl-4">&#39;UserDatabase&#39;</span><span class="hl-1">, </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-2">myDb</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-2">adapter</span><span class="hl-1">.</span><span class="hl-3">loadDatabase</span><span class="hl-1">(</span><span class="hl-4">&#39;UserDatabase&#39;</span><span class="hl-1">); </span><span class="hl-6">// will log the serialized db to console</span><br/><span class="hl-1">  </span><span class="hl-2">adapter</span><span class="hl-1">.</span><span class="hl-3">deleteDatabase</span><span class="hl-1">(</span><span class="hl-4">&#39;UserDatabase&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">adapter</span><span class="hl-1">.</span><span class="hl-3">getCatalogSummary</span><span class="hl-1">(); </span><span class="hl-6">// gets list of all keys along with their sizes</span>
</code></pre>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current"><a href="../../modules.html">SylvieJS</a>
<ul>
<li class="current pages-entry pages-entry-menu pages-entry-depth-1"><a>Tutorials</a>
<ul>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Autoupdating Collections.html">Autoupdating <wbr/>Collections</a></li>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Changes API.html">Changes API.md</a></li>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Collection Transforms.html">Collection <wbr/>Transforms.md</a></li>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Indexing and Query performance.html">Indexing and <wbr/>Query performance.md</a></li>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Loki Angular.html">Loki <wbr/>Angular.md</a></li>
<li class="current selected pages-entry pages-entry-page pages-entry-depth-2"><a href="Persistence Adapters.html">Persistence <wbr/>Adapters.md</a></li>
<li class="pages-entry pages-entry-page pages-entry-depth-2"><a href="Query Examples.html">Query <wbr/>Examples.md</a></li></ul></li>
<li class="tsd-kind-module"><a href="../../modules/index.html">index</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_collection.html">modules/collection</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_dynamic_view.html">modules/dynamic-<wbr/>view</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_index_exact_index.html">modules/index/exact-<wbr/>index</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_index_sorted_index.html">modules/index/sorted-<wbr/>index</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_index_unique_index.html">modules/index/unique-<wbr/>index</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_key_value_store.html">modules/key-<wbr/>value-<wbr/>store</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_result_set.html">modules/result-<wbr/>set</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_sylvie.html">modules/sylvie</a></li>
<li class="tsd-kind-module"><a href="../../modules/modules_sylvie_event_emitter.html">modules/sylvie-<wbr/>event-<wbr/>emitter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_crypted_indexeddb_adapter.html">storage-<wbr/>adapter/crypted-<wbr/>indexeddb-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_crypted_indexeddb_adapter_idb_catalog.html">storage-<wbr/>adapter/crypted-<wbr/>indexeddb-<wbr/>adapter/idb-<wbr/>catalog</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_crypted_indexeddb_adapter_string_encryption_utils.html">storage-<wbr/>adapter/crypted-<wbr/>indexeddb-<wbr/>adapter/string-<wbr/>encryption-<wbr/>utils</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_fs_adapter.html">storage-<wbr/>adapter/fs-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_incremental_indexeddb_adapter.html">storage-<wbr/>adapter/incremental-<wbr/>indexeddb-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_indexeddb_adapter.html">storage-<wbr/>adapter/indexeddb-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_local_storage_adapter.html">storage-<wbr/>adapter/local-<wbr/>storage-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_memory_adapter.html">storage-<wbr/>adapter/memory-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_partitioning_adapter.html">storage-<wbr/>adapter/partitioning-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/storage_adapter_persistence_adapter.html">storage-<wbr/>adapter/persistence-<wbr/>adapter</a></li>
<li class="tsd-kind-module"><a href="../../modules/sylviejs.html">sylviejs</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils.html">utils</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_binary_search.html">utils/binary-<wbr/>search</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_clone.html">utils/clone</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_clone_object_array.html">utils/clone-<wbr/>object-<wbr/>array</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_containsCheckFn.html">utils/contains<wbr/>Check<wbr/>Fn</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_deep_property.html">utils/deep-<wbr/>property</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_dotSubScan.html">utils/dot<wbr/>Sub<wbr/>Scan</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_icebox.html">utils/icebox</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_localStorageAvailable.html">utils/local<wbr/>Storage<wbr/>Available</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_math.html">utils/math</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_ops.html">utils/ops</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_parse_base_10.html">utils/parse-<wbr/>base-<wbr/>10</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_precompile_query.html">utils/precompile-<wbr/>query</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_sort.html">utils/sort</a></li>
<li class="tsd-kind-module"><a href="../../modules/utils_utils.html">utils/utils</a></li></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky"></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="../../assets/main.js"></script></body></html>